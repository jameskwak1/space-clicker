<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ìš°ì£¼ ë°©ì¹˜í˜• í´ë¦¬ì»¤</title>
  <style>
    /* ========== ê¸°ë³¸ ë¦¬ì…‹ ë° ì „ì²´ ë ˆì´ì•„ì›ƒ ========== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: 'Courier New', monospace;
      background: #050508;
      color: #00ffcc;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    /* ========== ê²Œì„ ìº”ë²„ìŠ¤ ì»¨í…Œì´ë„ˆ ========== */
    /* ëª¨ë°”ì¼: í™”ë©´ 100% ê½‰ ì±„ì›€ */
    #gameContainer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    /* PC: ìµœëŒ€ ë„ˆë¹„ 480px, ì •ì¤‘ì•™ ë°°ì¹˜ */
    @media (min-width: 769px) {
      #gameContainer {
        left: 50%;
        right: auto;
        transform: translateX(-50%);
        width: 100%;
        max-width: 480px;
        height: 100vh;
      }
    }
    #gameCanvas {
      display: block;
      width: 100%;
      height: 100%;
      background: radial-gradient(ellipse at center, #0d0d1a 0%, #050510 70%, #000 100%);
      cursor: crosshair;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }

    /* ========== ìƒë‹¨ UI (ê³¨ë“œ, ìŠ¤í…Œì´ì§€, ì²´ë ¥ë°”) ========== */
    #topUI {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 10px 15px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 15px;
      background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%);
      z-index: 10;
      pointer-events: none;
    }
    @media (min-width: 769px) {
      #topUI {
        left: 50%;
        right: auto;
        transform: translateX(-50%);
        width: 100%;
        max-width: 480px;
      }
    }
    #topUI > * { pointer-events: auto; }
    #goldDisplay {
      font-size: clamp(14px, 3vw, 20px);
      color: #ffd700;
      text-shadow: 0 0 10px #ffd700;
    }
    #stageDisplay {
      font-size: clamp(14px, 3vw, 20px);
      color: #00ffcc;
      text-shadow: 0 0 10px #00ffcc;
    }
    #healthBarContainer {
      flex: 1;
      min-width: 120px;
      max-width: 300px;
      height: 20px;
      background: rgba(0,0,0,0.6);
      border: 2px solid #00ffcc;
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(0,255,204,0.3);
    }
    #healthBarFill {
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, #ff4444, #ff8844);
      transition: width 0.1s ease;
    }
    #currentMonsterLabel {
      font-size: clamp(12px, 2.5vw, 16px);
      color: #ff8888;
    }

    /* ========== í•˜ë‹¨ UI (ìƒì  ë²„íŠ¼, ë°°ì†) ========== */
    #bottomUI {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 12px 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 100%);
      z-index: 10;
    }
    @media (min-width: 769px) {
      #bottomUI {
        left: 50%;
        right: auto;
        transform: translateX(-50%);
        width: 100%;
        max-width: 480px;
      }
    }
    #shopBtn {
      padding: 10px 20px;
      font-size: clamp(14px, 2.5vw, 18px);
      font-family: inherit;
      background: linear-gradient(180deg, #1a3a3a, #0d2a2a);
      color: #00ffcc;
      border: 2px solid #00ffcc;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 0 20px rgba(0,255,204,0.4);
      transition: transform 0.1s, box-shadow 0.2s;
    }
    #shopBtn:hover, #shopBtn:active {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(0,255,204,0.6);
    }
    #speedControls {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    #speedControls span {
      font-size: clamp(12px, 2vw, 14px);
      color: #888;
    }
    .speedBtn {
      padding: 8px 14px;
      font-size: clamp(12px, 2vw, 14px);
      font-family: inherit;
      background: #1a1a2a;
      color: #00ffcc;
      border: 1px solid #00ffcc;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .speedBtn:hover {
      background: #2a2a4a;
    }
    .speedBtn.active {
      background: #00ffcc;
      color: #0a0a12;
      box-shadow: 0 0 15px #00ffcc;
    }
    #autoClickBtn {
      padding: 8px 14px;
      font-size: clamp(12px, 2vw, 14px);
      font-family: inherit;
      background: #1a1a2a;
      color: #888;
      border: 1px solid #555;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    #autoClickBtn.on {
      background: #0d2a1a;
      color: #00ffcc;
      border-color: #00ffcc;
      box-shadow: 0 0 12px rgba(0,255,204,0.3);
    }
    #autoClickBtn.off { color: #666; }

    /* ========== ìƒì  ëª¨ë‹¬ ========== */
    #shopModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      z-index: 100;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    #shopModal.open {
      display: flex;
    }
    #shopContent {
      background: linear-gradient(180deg, #0d1a1a, #051010);
      border: 3px solid #00ffcc;
      border-radius: 12px;
      padding: 24px;
      max-width: 400px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 0 40px rgba(0,255,204,0.3), inset 0 0 60px rgba(0,0,0,0.5);
    }
    #shopContent h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #00ffcc;
      text-shadow: 0 0 15px #00ffcc;
      font-size: clamp(18px, 4vw, 24px);
    }
    .shopItem {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0,255,204,0.3);
      gap: 10px;
      flex-wrap: wrap;
    }
    .shopItem:last-child { border-bottom: none; }
    .shopItemInfo {
      flex: 1;
      min-width: 140px;
    }
    .shopItemInfo .name { color: #00ffcc; font-size: 14px; }
    .shopItemInfo .desc { color: #88aaaa; font-size: 12px; margin-top: 2px; }
    .shopItemInfo .level { color: #ffd700; font-size: 12px; margin-top: 2px; }
    .shopItem button {
      padding: 10px 16px;
      font-family: inherit;
      background: linear-gradient(180deg, #1a3a1a, #0d2a0d);
      color: #00ffcc;
      border: 2px solid #00ffcc;
      border-radius: 8px;
      cursor: pointer;
      white-space: nowrap;
      font-size: 13px;
      transition: all 0.2s;
    }
    .shopItem button:hover:not(:disabled) {
      background: #0d3a0d;
      box-shadow: 0 0 15px rgba(0,255,204,0.5);
    }
    .shopItem button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      border-color: #555;
    }
    #shopClose {
      display: block;
      margin: 20px auto 0;
      padding: 12px 30px;
      font-family: inherit;
      background: #2a1a1a;
      color: #ff6666;
      border: 2px solid #ff6666;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s;
    }
    #shopClose:hover {
      background: #3a2a2a;
      box-shadow: 0 0 15px rgba(255,100,100,0.4);
    }

    /* ========== ê²Œì„ ì˜¤ë²„ í™”ë©´ ========== */
    #gameOverOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      z-index: 200;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 20px;
    }
    #gameOverOverlay.show {
      display: flex;
    }
    #gameOverOverlay h2 {
      font-size: clamp(28px, 6vw, 48px);
      color: #ff4444;
      text-shadow: 0 0 30px #ff4444;
      margin-bottom: 20px;
    }
    #gameOverOverlay p {
      color: #aaa;
      margin-bottom: 24px;
      font-size: clamp(14px, 2.5vw, 18px);
    }
    #restartBtn {
      padding: 14px 32px;
      font-size: clamp(16px, 3vw, 20px);
      font-family: inherit;
      background: linear-gradient(180deg, #1a3a3a, #0d2a2a);
      color: #00ffcc;
      border: 2px solid #00ffcc;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 0 25px rgba(0,255,204,0.4);
      transition: all 0.2s;
    }
    #restartBtn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 35px rgba(0,255,204,0.6);
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="gameCanvas"></canvas>
  </div>

  <!-- ìƒë‹¨ UI: ê³¨ë“œ, ìŠ¤í…Œì´ì§€, í˜„ì¬ ëª¬ìŠ¤í„° ì²´ë ¥ë°” -->
  <div id="topUI">
    <span id="goldDisplay">ğŸ’° ê³¨ë“œ: 0</span>
    <span id="stageDisplay">ğŸ“¡ ìŠ¤í…Œì´ì§€: 1</span>
    <span id="currentMonsterLabel">ëª¬ìŠ¤í„° ì²´ë ¥</span>
    <div id="healthBarContainer">
      <div id="healthBarFill" style="width:100%"></div>
    </div>
  </div>

  <!-- í•˜ë‹¨ UI: ìƒì , ì˜¤í† í´ë¦­, ë°°ì† -->
  <div id="bottomUI">
    <button id="shopBtn">ğŸ›’ ìƒì  ì—´ê¸°</button>
    <button id="autoClickBtn" class="autoClickBtn off">ğŸ”„ ì˜¤í†  í´ë¦­: Off</button>
    <div id="speedControls">
      <span>ë°°ì†</span>
      <button class="speedBtn active" data-speed="1">x1</button>
      <button class="speedBtn" data-speed="2">x2</button>
      <button class="speedBtn" data-speed="4">x4</button>
    </div>
  </div>

  <!-- ìƒì  ëª¨ë‹¬ -->
  <div id="shopModal">
    <div id="shopContent">
      <h2>ğŸš€ ìš°ì£¼ ìƒì </h2>
      <div class="shopItem">
        <div class="shopItemInfo">
          <div class="name">âš”ï¸ ê³µê²©ë ¥ ì¦ê°€</div>
          <div class="desc">ë°ë¯¸ì§€ +2 (ë ˆë²¨ë‹¹)</div>
          <div class="level" id="damageLevel">Lv.1</div>
        </div>
        <button id="buyDamage">3G</button>
      </div>
      <div class="shopItem">
        <div class="shopItemInfo">
          <div class="name">ğŸ”« íƒ€ê²© íšŸìˆ˜</div>
          <div class="desc">í´ë¦­/ì˜¤í†  ì‹œ ë§¨ ì• ëª¬ìŠ¤í„°ì—ê²Œ ì£¼ëŠ” íƒ€ê²© íšŸìˆ˜</div>
          <div class="level" id="countLevel">Lv.1 (1ë°œ)</div>
        </div>
        <button id="buyCount">8G</button>
      </div>
      <div class="shopItem">
        <div class="shopItemInfo">
          <div class="name">â±ï¸ ì˜¤í†  í´ë¦­ ì†ë„</div>
          <div class="desc">ì˜¤í†  í´ë¦­ íƒ€ê²© ê°„ê²© ë‹¨ì¶• (Onì¼ ë•Œ ì ìš©)</div>
          <div class="level" id="autoSpeedLevel">Lv.1 (1ì´ˆ)</div>
        </div>
        <button id="buyAutoSpeed">4G</button>
      </div>
      <button id="shopClose">ë‹«ê¸°</button>
    </div>
  </div>

  <!-- ê²Œì„ ì˜¤ë²„ í™”ë©´ -->
  <div id="gameOverOverlay">
    <h2>ğŸ’€ ê²Œì„ ì˜¤ë²„</h2>
    <p>ëª¬ìŠ¤í„°ê°€ ìºë¦­í„°ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤!</p>
    <button id="restartBtn">ë‹¤ì‹œí•˜ê¸°</button>
  </div>

  <script>
    // ============================================================
    // ê²Œì„ ì „ì—­ ì„¤ì • ë° ìƒíƒœ
    // ============================================================
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let canvasWidth = 0, canvasHeight = 0;
    let gameSpeed = 1;           // ë°°ì† (1, 2, 4)
    let gold = 0;
    let stage = 1;
    let killsInCurrentStage = 0;  // í˜„ì¬ ìŠ¤í…Œì´ì§€ì—ì„œ ì²˜ì¹˜í•œ ìˆ˜ (ì¼ë°˜ 1~9ìŠ¤í…Œì´ì§€ì—ì„œ 100ëª… í•„ìš”)
    const NORMAL_STAGE_KILLS_REQUIRED = 100; // ì¼ë°˜ ìŠ¤í…Œì´ì§€(1~9) ì§„í–‰ì— í•„ìš”í•œ ì²˜ì¹˜ ìˆ˜
    let lastSpawnTime = 0;
    const SPAWN_INTERVAL = 60;        // ì—°ë‹¬ì•„ ë‚˜ì˜¤ëŠ” ê°„ê²© (ms) - ì£¼ë¥´ë¥µ
    const MAX_ENEMIES_ON_SCREEN = 100;  // í™”ë©´ì— ë™ì‹œì— ìˆì„ ìˆ˜ ìˆëŠ” ìµœëŒ€ ìˆ˜
    let lastAutoFireTime = 0;
    const BASE_AUTO_FIRE_INTERVAL = 1000; // ê¸°ì¤€ 1ì´ˆ (ì˜¤í†  í´ë¦­ ì†ë„ ì—…ê·¸ë ˆì´ë“œë¡œ ë‹¨ì¶•)

    let autoClickEnabled = false; // ì˜¤í†  í´ë¦­: ì‹œì‘ ì‹œ Off

    // ìƒì  ì—…ê·¸ë ˆì´ë“œ (ì €ì¥ìš©)
    let upgradeDamage = 1;      // ë ˆë²¨ë‹¹ +5 ë°ë¯¸ì§€
    let upgradeCount = 1;       // í´ë¦­/ì˜¤í†  ì‹œ ë§¨ ì• ëª¬ìŠ¤í„° íƒ€ê²© íšŸìˆ˜
    let upgradeAutoSpeed = 1;   // ì˜¤í†  í´ë¦­ ì†ë„ (ë ˆë²¨ ì˜¬ë¼ê°ˆìˆ˜ë¡ ê°„ê²© ë‹¨ì¶•)
    const DAMAGE_PER_LEVEL = 1;   // ë ˆë²¨ë‹¹ +1 ë°ë¯¸ì§€ (ì¡°ê¸ˆì”© ìƒìŠ¹)
    const COST_DAMAGE = 5;       // ì €ë ´í•œ ê¸°ë³¸ ë¹„ìš©
    const COST_COUNT = 10;
    const COST_AUTO_SPEED = 10;
    function getCostDamage(lv) { return COST_DAMAGE + (lv - 1) * 2; }
    function getCostCount(lv) { return COST_COUNT + (lv - 1) * 3; }
    function getCostAutoSpeed(lv) { return COST_AUTO_SPEED + (lv - 1) * 2; }

    // ëª¬ìŠ¤í„° íˆíŠ¸ë°•ìŠ¤ ì—¬ìœ  (ê·¼ì²˜ í”½ì…€ë§Œ ê°€ë„ ëª…ì¤‘ ì²˜ë¦¬)
    const HITBOX_PADDING = 28
;

    // í”Œë ˆì´ì–´ ìœ„ì¹˜ (í™”ë©´ í•˜ë‹¨ ì¤‘ì•™, í•˜ë‹¨ UI ìœ„ë¡œ ì˜¬ë ¤ì„œ ê°€ë¦¬ì§€ ì•ŠìŒ)
    let playerX = 0, playerY = 0;
    const PLAYER_WIDTH = 40;
    const PLAYER_HEIGHT = 30;
    const BOTTOM_UI_HEIGHT = 85; // í•˜ë‹¨ UI ë°” ìœ„ë¡œ ë” ì˜¬ë ¤ì„œ ìºë¦­í„°ê°€ ì™„ì „íˆ ë³´ì´ê²Œ
    const TOP_UI_HEIGHT = 55;    // ìƒë‹¨ UI ë†’ì´ - ì´ ì•„ë˜ë¶€í„° 'í™”ë©´ì— ë³´ì„'

    const missiles = [];
    const enemies = [];
    const particles = []; // íŒŒê´´ ì´í™íŠ¸

    // í˜„ì¬ íƒ€ê²Ÿ ëª¬ìŠ¤í„° (ì²´ë ¥ë°” í‘œì‹œìš©)
    let currentTargetEnemy = null;

    let gameOver = false; // ëª¬ìŠ¤í„°ê°€ í•˜ë‹¨(ìºë¦­í„° ìª½) ë„ë‹¬ ì‹œ true
    let lastShotTime = 0; // íƒ€ê²© ì‹œ ìŠˆíŒ… ëª¨ì…˜ ì´í™íŠ¸ìš©

    // ============================================================
    // ìº”ë²„ìŠ¤ í¬ê¸° ë°˜ì‘í˜• ì²˜ë¦¬ (ëª¨ë°”ì¼ 100% / PC ìµœëŒ€ 480px, ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ìºë¦­í„° ìœ„ì¹˜ ë³´ì •)
    // ============================================================
    function resizeCanvas() {
      const container = document.getElementById('gameContainer');
      const w = Math.max(1, container.clientWidth || window.innerWidth);
      const h = Math.max(1, container.clientHeight || window.innerHeight);
      canvasWidth = canvas.width = w;
      canvasHeight = canvas.height = h;
      playerX = Math.max(0, Math.min(canvasWidth - PLAYER_WIDTH, canvasWidth / 2 - PLAYER_WIDTH / 2));
      playerY = Math.max(0, canvasHeight - PLAYER_HEIGHT - BOTTOM_UI_HEIGHT);
    }
    function onResize() {
      requestAnimationFrame(() => {
        resizeCanvas();
        if (typeof initStars === 'function') initStars();
      });
    }
    window.addEventListener('resize', onResize);
    resizeCanvas();

    // ============================================================
    // ì (ëª¬ìŠ¤í„°) í´ë˜ìŠ¤ - ì§€ê·¸ì¬ê·¸(ë±€) ì´ë™: ì¢Œâ†”ìš° ì™•ë³µí•˜ë©° í•œ ì¹¸ì”© í•˜ê°•
    // type: 'normal' | 'miniboss' | 'boss'
    // ============================================================
    const LEFT_EDGE = 0;
    function getRightEdge() { return canvasWidth - 1; }

    class Enemy {
      constructor(x, health, type = 'normal') {
        this.x = x;
        this.y = -40;
        this.maxHealth = health;
        this.health = health;
        this.type = type;
        this.width = type === 'boss' ? 80 : type === 'miniboss' ? 36 : 24;
        this.height = type === 'boss' ? 60 : type === 'miniboss' ? 28 : 20;
        this.speed = (type === 'boss' ? 0.4 : type === 'miniboss' ? 0.7 : 1.0) * gameSpeed * 0.08;
        this.goldReward = this.getGoldReward();
        this.direction = 1; // 1 = ìš°ì¸¡ìœ¼ë¡œ, -1 = ì¢Œì¸¡ìœ¼ë¡œ
        this.rowHeight = this.height + 12; // í•œ ì¹¸ ë‚´ë ¤ê°ˆ ë•Œ ë†’ì´
      }
      getGoldReward() {
        let base = stage * 2 + Math.floor(stage / 10);
        if (this.type === 'miniboss') base *= 5;
        if (this.type === 'boss') base *= 20;
        return Math.max(1, base);
      }
      takeDamage(amount) {
        this.health -= amount;
        if (this.health <= 0) {
          gold += this.goldReward;
          spawnParticles(this.x + this.width/2, this.y + this.height/2, this.type);
          return true; // ì‚¬ë§
        }
        return false;
      }
      update(dt) {
        const rightEdge = getRightEdge() - this.width;
        this.x += this.direction * this.speed * dt;
        if (this.direction === 1) {
          if (this.x >= rightEdge) {
            this.x = rightEdge;
            this.y += this.rowHeight;
            this.direction = -1;
          }
        } else {
          if (this.x <= LEFT_EDGE) {
            this.x = LEFT_EDGE;
            this.y += this.rowHeight;
            this.direction = 1;
          }
        }
        if (this.y + this.height >= playerY - 5) gameOver = true;
        return this.y > canvasHeight + 50;
      }
      draw() {
        const c = this.type === 'boss' ? '#ff00aa' : this.type === 'miniboss' ? '#ffaa00' : '#00ff88';
        ctx.fillStyle = c;
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.shadowColor = c;
        ctx.shadowBlur = 15;
        ctx.fillRect(this.x, this.y, this.width, this.height);
        ctx.strokeRect(this.x, this.y, this.width, this.height);
        ctx.shadowBlur = 0;
        // ì²´ë ¥ë°” (ëª¬ìŠ¤í„° ìœ„)
        const barW = this.width;
        const barH = 4;
        ctx.fillStyle = '#222';
        ctx.fillRect(this.x, this.y - 8, barW, barH);
        ctx.fillStyle = '#0f0';
        ctx.fillRect(this.x, this.y - 8, barW * (this.health / this.maxHealth), barH);
      }
    }

    // ============================================================
    // íŒŒí‹°í´ (í­ë°œ ì´í™íŠ¸)
    // ============================================================
    function spawnParticles(x, y, type) {
      const count = type === 'boss' ? 25 : type === 'miniboss' ? 15 : 8;
      const color = type === 'boss' ? '#ff00aa' : type === 'miniboss' ? '#ffaa00' : '#00ff88';
      for (let i = 0; i < count; i++) {
        particles.push({
          x, y,
          vx: (Math.random() - 0.5) * 4,
          vy: (Math.random() - 0.5) * 4,
          life: 1,
          color,
          size: type === 'boss' ? 6 : type === 'miniboss' ? 4 : 3
        });
      }
    }

    // ============================================================
    // ìŠ¤í…Œì´ì§€ë³„ ëª¬ìŠ¤í„° ì²´ë ¥ ë° ìŠ¤í° íƒ€ì… ê²°ì •
    // ============================================================
    function getBaseHealth() {
      return 20 + stage * 8 + Math.floor(stage / 10) * 15;
    }
    function getSpawnType() {
      if (stage % 100 === 0 && stage >= 100) return 'boss';
      if (stage % 10 === 0 && stage >= 10) return 'miniboss';
      return 'normal';
    }
    function getEnemyHealth(type) {
      const base = getBaseHealth();
      if (type === 'boss') return base * 100;
      if (type === 'miniboss') return base * 10;
      return base;
    }

    // ============================================================
    // ì  ìŠ¤í° (ìƒë‹¨ì—ì„œ ëœë¤ x ìœ„ì¹˜, ì§€ê·¸ì¬ê·¸ ì‹œì‘)
    // ============================================================
    function spawnEnemy() {
      const type = getSpawnType();
      const health = getEnemyHealth(type);
      const size = type === 'boss' ? 80 : type === 'miniboss' ? 36 : 24;
      const x = Math.random() * Math.max(0, canvasWidth - size);
      enemies.push(new Enemy(x, health, type));
    }

    // ============================================================
    // ì˜¤í†  í´ë¦­ ë°œì‚¬ ê°„ê²© (ë ˆë²¨ ì˜¬ë¼ê°ˆìˆ˜ë¡ ì§§ì•„ì§, ìµœì†Œ 150ms)
    // ============================================================
    function getAutoFireInterval() {
      return Math.max(150, Math.floor(BASE_AUTO_FIRE_INTERVAL / upgradeAutoSpeed));
    }

    // ============================================================
    // UIìƒì— ì‹¤ì œë¡œ ë³´ì´ëŠ” ëª¬ìŠ¤í„°ì¸ì§€ (ìƒë‹¨ UI ì•„ë˜ ~ í•˜ë‹¨ UI ìœ„ êµ¬ê°„)
    // ============================================================
    function isEnemyVisibleOnScreen(e) {
      return (e.y + e.height > TOP_UI_HEIGHT) && (e.y < canvasHeight - BOTTOM_UI_HEIGHT);
    }

    // ============================================================
    // ê°€ì¥ ì•ì— ìˆëŠ” ì  = í™”ë©´ì— ë³´ì´ëŠ” ê²ƒ ì¤‘ í”Œë ˆì´ì–´ì—ê²Œ ê°€ì¥ ê°€ê¹Œìš´(y ìµœëŒ€)
    // UIìƒ ëª¬ìŠ¤í„°ê°€ ì—†ìœ¼ë©´ íƒ€ê²ŒíŒ… ì•ˆ ë¨
    // ============================================================
    function getFrontmostEnemy() {
      let front = null;
      for (let i = 0; i < enemies.length; i++) {
        if (!isEnemyVisibleOnScreen(enemies[i])) continue;
        if (front === null || enemies[i].y > front.y) front = enemies[i];
      }
      return front;
    }

    // ============================================================
    // í´ë¦­/ì˜¤í†  = ë§¨ ì• ëª¬ìŠ¤í„°ì—ê²Œ ì¦‰ì‹œ ë°ë¯¸ì§€ (ë°œì‚¬ì²´ ì—†ìŒ, ë¬´ì¡°ê±´ íƒ€ê²ŸíŒ…)
    // ============================================================
    function fireMissiles() {
      lastShotTime = performance.now();
      const damage = upgradeDamage * DAMAGE_PER_LEVEL;
      for (let i = 0; i < upgradeCount; i++) {
        const target = getFrontmostEnemy();
        if (!target) break;
        const dead = target.takeDamage(damage);
        if (dead) {
          const idx = enemies.indexOf(target);
          if (idx !== -1) enemies.splice(idx, 1);
          if (stage <= 9) {
            killsInCurrentStage++;
            if (killsInCurrentStage >= NORMAL_STAGE_KILLS_REQUIRED) {
              stage++;
              killsInCurrentStage = 0;
            }
          } else {
            stage++;
          }
          lastSpawnTime = performance.now();
        }
      }
    }

    // ============================================================
    // UI ì—…ë°ì´íŠ¸ (ê³¨ë“œ, ìŠ¤í…Œì´ì§€, ì²´ë ¥ë°”)
    // ============================================================
    function updateUI() {
      document.getElementById('goldDisplay').textContent = 'ğŸ’° ê³¨ë“œ: ' + gold;
      if (stage <= 9) {
        document.getElementById('stageDisplay').textContent = 'ğŸ“¡ ìŠ¤í…Œì´ì§€: ' + stage + ' (' + killsInCurrentStage + '/' + NORMAL_STAGE_KILLS_REQUIRED + ')';
      } else {
        document.getElementById('stageDisplay').textContent = 'ğŸ“¡ ìŠ¤í…Œì´ì§€: ' + stage;
      }

      currentTargetEnemy = getFrontmostEnemy();
      const bar = document.getElementById('healthBarFill');
      const label = document.getElementById('currentMonsterLabel');
      if (currentTargetEnemy) {
        const pct = (currentTargetEnemy.health / currentTargetEnemy.maxHealth) * 100;
        bar.style.width = pct + '%';
        const typeName = currentTargetEnemy.type === 'boss' ? 'ë³´ìŠ¤' : currentTargetEnemy.type === 'miniboss' ? 'ì¤€ë³´ìŠ¤' : 'ëª¬ìŠ¤í„°';
        label.textContent = typeName + ' ì²´ë ¥';
      } else {
        bar.style.width = '100%';
        label.textContent = 'ë‹¤ìŒ ëª¬ìŠ¤í„° ëŒ€ê¸° ì¤‘';
      }

      // ìƒì  ë²„íŠ¼ í…ìŠ¤íŠ¸ (ì €ë ´í•œ ë¹„ìš© + ì™„ë§Œí•œ ìƒìŠ¹)
      document.querySelector('#buyDamage').textContent = getCostDamage(upgradeDamage) + 'G';
      document.querySelector('#buyCount').textContent = getCostCount(upgradeCount) + 'G';
      document.querySelector('#buyAutoSpeed').textContent = getCostAutoSpeed(upgradeAutoSpeed) + 'G';
      document.getElementById('damageLevel').textContent = 'Lv.' + upgradeDamage + ' (+' + (upgradeDamage * DAMAGE_PER_LEVEL) + ' ë°ë¯¸ì§€)';
      document.getElementById('countLevel').textContent = 'Lv.' + upgradeCount + ' (' + upgradeCount + 'íšŒ)';
      document.getElementById('autoSpeedLevel').textContent = 'Lv.' + upgradeAutoSpeed + ' (' + (getAutoFireInterval()/1000).toFixed(1) + 'ì´ˆ)';

      document.querySelector('#buyDamage').disabled = gold < getCostDamage(upgradeDamage);
      document.querySelector('#buyCount').disabled = gold < getCostCount(upgradeCount);
      document.querySelector('#buyAutoSpeed').disabled = gold < getCostAutoSpeed(upgradeAutoSpeed);

      const autoBtn = document.getElementById('autoClickBtn');
      if (autoClickEnabled) {
        autoBtn.textContent = 'ğŸ”„ ì˜¤í†  í´ë¦­: On';
        autoBtn.classList.remove('off');
        autoBtn.classList.add('on');
      } else {
        autoBtn.textContent = 'ğŸ”„ ì˜¤í†  í´ë¦­: Off';
        autoBtn.classList.remove('on');
        autoBtn.classList.add('off');
      }
    }

    // ============================================================
    // ë°°ê²½ ë³„ ê·¸ë¦¬ê¸° (ìš°ì£¼ ëŠë‚Œ)
    // ============================================================
    const stars = [];
    function initStars() {
      stars.length = 0;
      for (let i = 0; i < 80; i++) {
        stars.push({
          x: Math.random() * canvasWidth,
          y: Math.random() * canvasHeight,
          r: Math.random() * 1.5 + 0.5,
          alpha: Math.random() * 0.5 + 0.3
        });
      }
    }
    function drawStars() {
      stars.forEach(s => {
        ctx.fillStyle = `rgba(255,255,255,${s.alpha})`;
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    // ============================================================
    // í”Œë ˆì´ì–´(ê¸°ì²´) ê·¸ë¦¬ê¸° + íƒ€ê²© ì‹œ ìŠˆíŒ… ëª¨ì…˜ ì´í™íŠ¸
    // ============================================================
    function drawPlayer(now) {
      const cx = playerX + PLAYER_WIDTH / 2;
      const cy = playerY + PLAYER_HEIGHT / 2;
      ctx.fillStyle = '#00ffcc';
      ctx.strokeStyle = '#fff';
      ctx.shadowColor = '#00ffcc';
      ctx.shadowBlur = 20;
      ctx.fillRect(playerX, playerY, PLAYER_WIDTH, PLAYER_HEIGHT);
      ctx.strokeRect(playerX, playerY, PLAYER_WIDTH, PLAYER_HEIGHT);
      ctx.fillStyle = '#006666';
      ctx.fillRect(playerX + 4, playerY + 4, PLAYER_WIDTH - 8, PLAYER_HEIGHT - 8);
      ctx.shadowBlur = 0;
      const shotAge = now - lastShotTime;
      if (shotAge < 140) {
        const t = 1 - shotAge / 140;
        ctx.save();
        ctx.globalAlpha = t;
        ctx.fillStyle = '#00ffff';
        ctx.shadowColor = '#00ffff';
        ctx.shadowBlur = 12;
        const beamH = 18 + t * 22;
        ctx.beginPath();
        ctx.moveTo(cx - 3, cy - 4);
        ctx.lineTo(cx + 3, cy - 4);
        ctx.lineTo(cx + 2, cy - 4 - beamH);
        ctx.lineTo(cx - 2, cy - 4 - beamH);
        ctx.closePath();
        ctx.fill();
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 1;
        ctx.stroke();
        ctx.restore();
      }
    }

    // ============================================================
    // ê²Œì„ ë£¨í”„
    // ============================================================
    let lastTime = performance.now();
    function gameLoop(now) {
      if (gameOver) {
        document.getElementById('gameOverOverlay').classList.add('show');
        requestAnimationFrame(gameLoop);
        return;
      }

      const dt = Math.min((now - lastTime) * gameSpeed, 200);
      lastTime = now;

      if (enemies.length < MAX_ENEMIES_ON_SCREEN && (now - lastSpawnTime >= SPAWN_INTERVAL)) {
        lastSpawnTime = now;
        spawnEnemy();
      }

      if (autoClickEnabled && (now - lastAutoFireTime >= getAutoFireInterval() / gameSpeed)) {
        lastAutoFireTime = now;
        fireMissiles();
      }

      for (let i = enemies.length - 1; i >= 0; i--) {
        if (enemies[i].update(dt)) enemies.splice(i, 1);
      }

      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 0.03;
        if (p.life <= 0) particles.splice(i, 1);
      }

      ctx.fillStyle = '#050510';
      ctx.fillRect(0, 0, canvasWidth, canvasHeight);
      drawStars();
      enemies.forEach(e => e.draw());
      drawPlayer(now);
      particles.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.life;
        ctx.fillRect(p.x - p.size/2, p.y - p.size/2, p.size, p.size);
        ctx.globalAlpha = 1;
      });
      updateUI();

      requestAnimationFrame(gameLoop);
    }

    // ============================================================
    // ê²Œì„ ë¦¬ì…‹ (ë‹¤ì‹œí•˜ê¸°)
    // ============================================================
    function resetGame() {
      gameOver = false;
      gold = 0;
      stage = 1;
      killsInCurrentStage = 0;
      upgradeDamage = 1;
      upgradeCount = 1;
      upgradeAutoSpeed = 1;
      autoClickEnabled = false;
      enemies.length = 0;
      missiles.length = 0;
      particles.length = 0;
      lastSpawnTime = performance.now();
      document.getElementById('gameOverOverlay').classList.remove('show');
      spawnEnemy();
    }

    // ============================================================
    // í´ë¦­ ì‹œ ë§¨ ì• ëª¬ìŠ¤í„° íƒ€ê²©
    // ============================================================
    canvas.addEventListener('click', (e) => {
      fireMissiles();
    });

    // ============================================================
    // ì˜¤í†  í´ë¦­ On/Off í† ê¸€
    // ============================================================
    document.getElementById('autoClickBtn').addEventListener('click', () => {
      autoClickEnabled = !autoClickEnabled;
      if (autoClickEnabled) lastAutoFireTime = performance.now();
    });

    // ============================================================
    // ë°°ì† ë²„íŠ¼
    // ============================================================
    document.querySelectorAll('.speedBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        gameSpeed = parseInt(btn.dataset.speed, 10);
        document.querySelectorAll('.speedBtn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    // ============================================================
    // ìƒì  ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
    // ============================================================
    document.getElementById('shopBtn').addEventListener('click', () => {
      document.getElementById('shopModal').classList.add('open');
    });
    document.getElementById('shopClose').addEventListener('click', () => {
      document.getElementById('shopModal').classList.remove('open');
    });
    document.getElementById('shopModal').addEventListener('click', (e) => {
      if (e.target.id === 'shopModal') document.getElementById('shopModal').classList.remove('open');
    });

    document.getElementById('restartBtn').addEventListener('click', () => {
      resetGame();
    });

    // ============================================================
    // ìƒì  êµ¬ë§¤ ì²˜ë¦¬
    // ============================================================
    document.getElementById('buyDamage').addEventListener('click', () => {
      const cost = getCostDamage(upgradeDamage);
      if (gold >= cost) {
        gold -= cost;
        upgradeDamage++;
      }
    });
    document.getElementById('buyCount').addEventListener('click', () => {
      const cost = getCostCount(upgradeCount);
      if (gold >= cost) {
        gold -= cost;
        upgradeCount++;
      }
    });
    document.getElementById('buyAutoSpeed').addEventListener('click', () => {
      const cost = getCostAutoSpeed(upgradeAutoSpeed);
      if (gold >= cost) {
        gold -= cost;
        upgradeAutoSpeed++;
      }
    });

    // ============================================================
    // ë³„ ì´ˆê¸°í™” ë° ê²Œì„ ì‹œì‘
    // ============================================================
    initStars();
    spawnEnemy();
    lastAutoFireTime = performance.now();
    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>
